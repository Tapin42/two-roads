<!DOCTYPE html>
<html>
  <head>
    <style type="text/css">
      html, body { height: 100%; margin: 0; padding: 0; }
      #map { height: 100%; display: none;}
    </style>
  </head>
  <body>
    <div id="splash">
      <div id="error"></div>
      <div id="parks"></div>
    </div>
    <div id="map"></div>

    <script type="text/javascript">

var map;

function ready() {
  $.ajax('http://localhost:8000/').done(function (data) {
    if (!data) {
      $('#error').html('Error downloading root manifest.');
      return;
    }

    try {
      if (data.error) {
        throw new Error(data.error);
      }

      data.parks.forEach(function (park) {
        var button = $('<button/>')
          .text(park)
          .click(function () {
            loadPark(park)
          });
        $('#parks').append(button);
      });

    } catch (e) {
      $('#error').html('Error handling JSON response: ' + e);
    }
  });
}

function loadPark(park) {
  $.ajax('http://localhost:8000/' + park).done(function (data) {
    if (!data) {
      $('#error').html('Error downloading ' + park + ' manifest.');
      return;
    }

    initMap(data)
  })
}

function toggleMapVisbility(isVisible) {
  if (isVisible) {
    $('#splash').hide();
    $('#map').show();
  } else {
    $('#map').hide();
    $('#splash').show();
  }
}

function initMap(park) {
  toggleMapVisibility(true);

  map = new google.maps.Map(document.getElementById('map'), park.start);

  park.maps.forEach(function (overlay) {
    var bounds = new google.maps.LatLngBounds(
      new google.maps.LatLng(overlay.bounds[0], overlay.bounds[1]),
      new google.maps.LatLng(overlay.bounds[2], overlay.bounds[3])
      );

    var overlay = new google.maps.GroundOverlay(park.dir + '/' + overlay.url, bounds);
    overlay.setMap(map);
  })
}

    </script>
    <script src="//code.jquery.com/jquery-1.11.3.min.js"></script>
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCqEbiDYhhRnGr4MHqDEq7iK4x0mmp9j50&callback=ready">
    </script>
  </body>
</html>
